<!DOCTYPE html><html lang="en"><head><title>Windows and sleep mode - Lietu's tech blog - Lietu's homepage</title><meta name="description" content="Janne Enberg, aka. Lietu's homepage"><meta name="keywords" content="Janne Enberg Lietu programmer IT generalist homepage"><link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,800' rel='stylesheet' type='text/css'><link href='/assets/global-01852371966e6ab602598d856f6fb404.css' rel='stylesheet' type='text/css'/> <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script><script src='/assets/global-eb0b8eea4ca1154082ff522f29d0194d.js'></script></head><body> <header><h1><a href="/">Lietu's homepage</a></h1> </header><div class="container"><div class="row"><div class="page span12"><div class="navbar navbar-inverse"><div class="navbar-inner"><div class="container"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></a><div class="nav-collapse collapse"><ul class="nav"><li><a href="/" title="Home"><i class="icon-home icon-white"></i></a></li><li><a href="/blog.html" title="Lietu's tech blog">Tech Blog</a></li><li><a href="/about.html" title="About Lietu">About</a></li><li><a href="/credits.html" title="Credits">Credits</a></li><li><a href="/links.html" title="Links to more resources">Links</a></li><li><a href="/cv.html" title="Curriculum Vitae - Janne Enberg">Curriculum Vitae</a></li></ul></div></div></div></div><div class="content"><section class="blog" itemscope itemtype="http://schema.org/Blog"><div class="span11"><h2 itemprop="name">Lietu's tech blog</h2></span></div><div class="span11 description"><span itemprop="description">Yet another techie blog by Janne Enberg, aka. Lietu</span></div><div class="span9 blog-content"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPost" class="well"><h3 itemprop="name">Windows and sleep mode</h3><div class="post-date">Posted <span itemprop="datePublished" class="date">2012-12-22</span></div><div itemprop="articleBody"><h4>Getting Windows to play nicely with sleep mode</h4><p>I just recently decided to get my main desktop to finally work with sleep mode properly. It has never worked in the past (the heart of the machine, mobo &amp; cpu, are a couple years old), but now I felt like I want to do something about it.</p><p>As a quick reference, here are the key details of the machine:</p><p><ul><li><strong>OS:</strong> Windows 7 Professional</li><li><strong>CPU:</strong> Intel Core i7 920, overclocked</li><li><strong>RAM:</strong> 6GB triple channeled 1600MHz DDR3, OCZ</li><li><strong>Motherboard:</strong> Asus Rampage II Extreme (X58 / ICH10R)</li><li><strong>GPU:</strong> EVGA Nvidia GeForce GTX 580</li><li><strong>Audio:</strong> Asus Xonar Essence STX</li><li><strong>SSD:</strong> OCZ RevoDrive 3 x2 240GB</li></ul></p><h4>Getting Windows to recover from sleep mode</h4><p>Initially, my issue was that the computer failed to recover from sleep mode. It went into sleep mode just fine, but when recovering I would end up with my screen not powering on from standby mode, but music would start playing fine (if I left a music player on when entering sleep mode). A while later, I could hear from the music that the machine blue screened.</p><p>I ended up fixing this issue, by disconnecting all USB devices that were not my keyboard and mouse and trying again. It worked, and all that was left was to figure out which device caused the issue. The cause turned out to be my printer, and turning it off before trying to sleep is a fix.</p><p>There are a lot of other possible causes, this is just what fixed it for me. You should also try and update all your drivers (no, I will not help you with how to do it), and Googling for more options.</p><h4>Getting Windows to not wake up from sleep mode too easily</h4><p>After I got the sleep mode to work, I bumped into another issue. The machine would wake up from sleep mode with the slightest move of the mouse, by pressing any button on the keyboard, and stuff like that.</p><p>This is not an option for me, since I have cats. They like to walk around everywhere, including on my keyboard. I wanted the machine to only wake up when I press the power button, which is cat-proof.</p><p>After some Googling, I found two useful commands for this:</p><div class="highlight"><pre><code class="bat">powercfg -devicequery wake_armed
</code></pre></div><p>Lists devices that can wake up Windows from sleep mode</p><div class="highlight"><pre><code class="bat">powercfg -devicedisablewake <span class="s2">"Device Name"</span>
</code></pre></div><p>Disables waking up on events from the device</p><p>Now turn that into some Windows Batch magic and you end up with the command:</p><div class="highlight"><pre><code class="bat"><span class="k">for</span> <span class="n">/F</span> <span class="s2">"tokens=*"</span> <span class="nv">%A</span> in (<span class="s1">'powercfg -devicequery wake_armed'</span>) <span class="k">do</span> powercfg -devicedisablewake <span class="s2">"%A"</span>
</code></pre></div><p>(Write it on an Administrator Command Prompt, all on one line)</p><p>What that does is query powercfg for all devices that can wake up Windows from sleep mode, loop through them one by one and then disable waking up from events for each one.</p><h4>Windows not automatically going to sleep mode?</h4><p>So of course, this is Windows, so the issues didn't end here. After these issues were resolved, I could successfully put the machine to sleep mode, recover it, and not recover needlessly when my cats were running around. However, the machine would not automatically go to sleep after the timeout set in Power Options -control panel.</p><p>There are a few possible reasons for this, that I (now) know of. For one, an application (video player in general) is preventing automatic sleep, or a driver (e.g. your sound card) is doing that. If you have similar issues, this is what you can do to get it working.</p><p><ul><li>Set your active power plan's "Put the computer to sleep" -setting to 1 minute</li><li>In an Administrator Command Prompt, run: powercfg -energy -output "C:\energy_diagnostics.html"</li><li>Wait for it to finish, and open the generated file (C:\energy_diagnostics.html) in a browser</li><li>It should tell you if it's an application, or if like in my case, it's a device driver that is preventing the automatic sleeping</li><li>If it is an application, either close that application or check it's settings (or Google more) to stop it from preventing automatic sleeping</li><li>In my case, it said:</li><ul><li>The device or driver has made a request to prevent the system from automatically entering sleep.</li><li>Requesting Driver Device: ASUS Xonar Essence STX Audio Device</li></ul><li>To ignore this request from the driver, run the command (replace "ASUS Xonar Essence STX Audio Device" with the name of your device, duh):</li><ul><li>powercfg -requestsoverride driver "ASUS Xonar Essence STX Audio Device" system</li></ul></ul></p><p>After this fix, my computer would finally work properly with sleep mode, including automatically going to sleep after a set timeout (30min in my case), and requiring me to actually press the cat-proof power button to wake it up again.</p></div> <small>Copyright © 2012 Janne Enberg. All rights reserved.</small> </article></div><div class="span2 sidebar well"><h3>About</h3><div class="about-blog" itemscope itemtype="http://schema.org/Person"> <img src="/img/blog/lietu.jpg" itemprop="image"/><p>The author, <span itemprop="name">Janne Enberg</span> aka. <a href="http://lietu.net/">Lietu</a>, is an IT generalist from Espoo, Finland.</p></div><h3>Posts</h3><div class="sidebar-post"> <span class="date">2012-12-26</span> <a href="/2012/12/jekyll.html" title="Jekyll">Jekyll</a></div><div class="sidebar-post"> <span class="date">2012-12-23</span> <a href="/2012/12/linux-and-sleep-mode-wakeup.html" title="Linux and sleep mode wakeup">Linux and sleep mode wakeup</a></div><div class="sidebar-post"> <span class="date">2012-12-22</span> <a href="/2012/12/windows-and-sleep-mode.html" title="Windows and sleep mode">Windows and sleep mode</a></div><div class="sidebar-post"> <span class="date">2012-11-04</span> <a href="/2012/11/vmware-esxi-freenas-nfs-vs-iscsi.html" title="VMware ESXi + FreeNAS, NFS vs. iSCSI performance">VMware ESXi + FreeNAS, NFS vs. iSCSI performance</a></div><div class="sidebar-post"> <span class="date">2012-09-17</span> <a href="/2012/09/simple-linuxbsd-service-monitoring.html" title="Simple Linux/BSD service monitoring script">Simple Linux/BSD service monitoring script</a></div><div class="sidebar-post"> <span class="date">2012-07-29</span> <a href="/2012/07/installing-mageia-2-or-most-linux.html" title="Installing Mageia 2 (or most Linux systems) on Mac Mini 4.1 (mid 2010 edition) (and probably other Macs too)">Installing Mageia 2 (or most Linux systems) on Mac Mini 4.1 (mid 2010 edition) (and probably other Macs too)</a></div><div class="sidebar-post"> <span class="date">2012-05-02</span> <a href="/2012/05/creating-ubuntu-server-virtual-machine.html" title="Creating an Ubuntu Server virtual machine with Node.js">Creating an Ubuntu Server virtual machine with Node.js</a></div></div> </section></div></div></div><div class="push"></div></div><footer><p> Copyright © 2013 by Janne Enberg. All rights reserved.<br/> Last updated 2013-01-04 18:31:08</p> </footer><div id="imgModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="imgModalLabel" aria-hidden="true"><div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button><h3 id="imgModalLabel">Original version</h3></div><div class="modal-body"> <img/></div><div class="modal-footer"> <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button></div></div></body></html>